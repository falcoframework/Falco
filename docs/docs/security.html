<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Falco - F# web toolkit for ASP.NET Core</title><meta name="description" content="A functional-first toolkit for building brilliant ASP.NET Core applications using F#." /><link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" /><link rel="icon" href="/favicon.ico" type="image/x-icon" /><link rel="preconnect" href="https://fonts.gstatic.com" /><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet" /><link href="/prism.css" rel="stylesheet" /><link href="/tachyons.css" rel="stylesheet" /><link href="/style.css" rel="stylesheet" /><script async src="https://www.googletagmanager.com/gtag/js?id=G-D62HSJHMNZ"></script><script>window.dataLayer = window.dataLayer || [];
                function gtag(){dataLayer.push(arguments);}
                gtag('js', new Date());
                gtag('config', 'G-D62HSJHMNZ');</script></head><body class="noto lh-copy"><div class="min-vh-100 mw9 center pa3 overflow-hidden"><nav class="sidebar w-20-l fl-l mb3 mb0-l"><div class="flex items-center"><a href="/docs" class="db w3 w4-l"><img src="/brand.svg" class="br3" /></a><h2 class="dn-l mt3 ml3 fw4 gray">Falco Documentation</h2></div><div class="dn db-l"><h3>Contents</h3><ul class="nl3 f6"><li><a href="get-started.html">Getting Started</a></li><li><a href="routing.html">Routing</a></li><li><a href="response.html">Writing responses</a></li><li><a href="request.html">Accessing request data</a></li><li><a href="markup.html">View engine</a></li><li><a href="security.html">Security</a></li><li><a href="example-hello-world.html">Examples</a></li></ul></div></nav><main class="w-80-l fl-l pl3-l"><h1 id="security">Security</h1>
<h2 id="authentication">Authentication</h2>
<p>ASP.NET Core has amazing built-in support for authentication. Review the <a href="https://docs.microsoft.com/en-us/aspnet/core/security/authentication">docs</a> for specific implementation details. Falco includes some authentication utilities.</p>
<pre><code class="language-fsharp">open Falco

let authScheme = &quot;some.secure.scheme&quot;

// Allow only authenticated access
let secureResourceHandler : HttpHandler =
    let handleAuth : HttpHandler =
        Response.ofPlainText &quot;hello authenticated user&quot;

    Request.ifAuthenticated authScheme handleAuth

// Allow only non-authenticated access
let anonResourceOnlyHandler : HttpHandler =
    let handleAnon : HttpHandler =
        Response.ofPlainText &quot;hello anonymous&quot;

    Request.ifNotAuthenticated authScheme handleAnon

// Allow only authenticated access when in certain role(s)
let secureResourceHandler : HttpHandler =
    let handleAuthInRole : HttpHandler =
        Response.ofPlainText &quot;hello admin&quot;

    let rolesAllowed = [ &quot;Admin&quot; ]

    Request.ifAuthenticatedInRole authScheme rolesAllowed handleAuthInRole

// Allow only authenticated acces with a certain scope
let secureResourceHandler : HttpHandler =
    let handleAuthHasScope : HttpHandler =
        Response.ofPlainText &quot;user1, user2, user3&quot;

    let issuer = &quot;https://oauth2issuer.com&quot;
    let scope = &quot;read:users&quot;

    Request.ifAuthenticatedWithScope authScheme issuer scope handleAuthHasScope

// Terminate authenticated session
let logOut : HttpHandler =
    let authScheme = &quot;...&quot;
    let redirectTo = &quot;/login&quot;

    Response.signOutAndRedirect authScheme redirectTo
</code></pre>
<h2 id="cross-site-scripting-xss-attacks">Cross-site Scripting (XSS) Attacks</h2>
<p>Cross-site scripting attacks are extremely common since they are quite simple to carry out. Fortunately, protecting against them is as easy as performing them.</p>
<p>The <a href="https://docs.microsoft.com/en-us/aspnet/core/security/anti-request-forgery">Microsoft.AspNetCore.Antiforgery</a> package provides the required utilities to easily protect yourself against such attacks.</p>
<p>Falco provides a few handlers via <code>Falco.Security.Xss</code>:</p>
<blockquote>
<p>To use the Xss helpers, ensure that the <code>Antiforgery</code> service has been registered.</p>
</blockquote>
<pre><code class="language-fsharp">open Falco.Markup
open Falco.Security

let formView token =
    Elem.html [] [
        Elem.body [] [
            Elem.form [ Attr.methodPost ] [
                // using the CSRF HTML helper, recommended to include as first
                // form element
                Xss.antiforgeryInput token
                Elem.control &quot;first_name&quot; [] [ Text.raw &quot;First Name&quot; ]
                Elem.control &quot;first_name&quot; [] [ Text.raw &quot;First Name&quot; ]
                Elem.input [ Attr.typeSubmit ]
            ]
        ]
    ]

// A handler that demonstrates obtaining a
// CSRF token and applying it to a view
let csrfViewHandler : HttpHandler =
    Response.ofHtmlCsrf formView

// A handler that demonstrates validating
// the request's CSRF token
let mapFormSecureHandler : HttpHandler =
    let mapPerson (form : FormData) =
        { FirstName = form?first_name.AsString()
          LastName = form?last_name.AsString }

    let handleInvalid : HttpHandler =
        Response.withStatusCode 400
        &gt;&gt; Response.ofEmpty

    Request.mapFormSecure mapPerson Response.ofJson handleInvalid
</code></pre>
<p><a href="example-hello-world.html">Next: Example - Hello World</a></p>
</main></div><footer class="cl pa3 bg-merlot"><div class="f7 tc white-70">&copy; 2020-2024 Pim Brouwers & contributors.</div></footer><script src="/prism.js"></script></body></html>